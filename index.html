<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Essential Meta Tag for Mobile Apps: Ensures proper scaling and disables zoom -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Creative Journal</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* General Styling and Background */
    body {
      margin: 0;
      font-family: 'Nunito', sans-serif;
      font-size: 16px;
      background: url('https://images.unsplash.com/photo-1552053831-71594a27632d') no-repeat center center fixed;
      background-size: cover;
      color: #4E342E;
      overflow: hidden;
       /* Optimization for App Feel: Disable text selection and tap highlights */
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    
    * {
        box-sizing: border-box;
    }

    /* Overlay */
    .overlay {
      background-color: rgba(255, 248, 220, 0.2);
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 0;
      backdrop-filter: blur(5px);
    }

    .app-container {
      display: flex;
      height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Sidebar Styling */
    .sidebar {
      width: 280px;
      background-color: rgba(255, 250, 240, 0.95); /* Increased opacity for mobile drawer */
      backdrop-filter: blur(10px);
      overflow-y: auto;
      padding: 20px 10px;
      border-right: 1px solid rgba(140, 90, 40, 0.2);
      box-shadow: 2px 0 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease-in-out; /* Smooth transition for mobile drawer */
      z-index: 10; /* Ensure sidebar is above main content */
    }

    /* Mobile Menu (Hamburger) Button */
    .menu-toggle {
        display: none; /* Hidden by default (desktop) */
        position: absolute;
        top: 15px;
        left: 15px;
        font-size: 30px;
        background: rgba(255, 250, 240, 0.8);
        border: 1px solid rgba(140, 90, 40, 0.2);
        border-radius: 5px;
        padding: 5px 10px;
        cursor: pointer;
        z-index: 5;
        color: #4E342E;
    }

    .tab-button {
      display: block;
      width: 100%;
      padding: 12px 15px;
      background: none;
      border: none;
      font-family: 'Nunito', sans-serif;
      font-size: 26px;
      font-weight: 800;
      color: #6D4C41;
      text-align: left;
      cursor: pointer;
      transition: background-color 0.3s;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    /* Added :active for better touch feedback */
    .tab-button:hover, .tab-button:active {
      background-color: rgba(255, 213, 79, 0.5);
    }

    .tab-button.active {
      background-color: #DAA520;
      color: #fff;
    }

    /* Main Content Area */
    .main-area {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
    }

    /* Textarea Styling */
    #entryInput {
      width: 100%;
      height: 40vh;
      font-size: 18px;
      font-family: 'Nunito', sans-serif;
      padding: 15px;
      margin-bottom: 15px;
      background-color: rgba(255, 255, 255, 0.95);
      color: #4E342E;
      border: 1px solid #DAA520;
      border-radius: 8px;
      resize: none;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      line-height: 1.5;
       /* Allow selection only within the input field */
      user-select: text;
    }

    #entryInput::placeholder {
      color: #A1887F;
    }

    /* Top Button Container */
    .top-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    /* Button and Select Styling */
    .top-buttons button, #colorPicker {
      background-color: #FFC107;
      border: none;
      padding: 12px 15px; /* Increased padding for better touch targets */
      margin: 5px;
      color: #4E342E;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.3s;
      font-family: 'Nunito', sans-serif;
      font-weight: 700;
      font-size: 16px;
    }

    .top-buttons button:hover, .top-buttons button:active {
      background-color: #FFD54F;
    }

    /* Special styling for the Inspire button */
    .inspire-button {
        background-color: #FFA000;
        color: #fff;
    }

    .inspire-button:hover, .inspire-button:active {
        background-color: #FFC107;
        box-shadow: 0 0 15px #FFC107;
    }

    .color-label {
        font-family: 'Nunito', sans-serif; font-size: 20px; font-weight: 700; color: #4E342E; background-color: rgba(255,255,255,0.5); padding: 5px 10px; border-radius: 5px;
    }


    /* Inspiration Area */
    .inspiration-area {
        font-family: 'Nunito', sans-serif;
        font-size: 24px;
        font-weight: 700;
        text-align: center;
        padding: 15px;
        margin-bottom: 15px;
        background-color: rgba(255, 235, 160, 0.7);
        border-radius: 8px;
        min-height: 30px;
    }

    /* History Area */
    .history {
      display: flex;
      overflow-x: auto;
      margin-top: 15px;
      border-top: 1px solid rgba(140, 90, 40, 0.3);
      padding-top: 15px;
    }

    .history-entry {
      background-color: rgba(255, 255, 255, 0.7);
      padding: 8px 12px;
      margin-right: 10px;
      cursor: pointer;
      font-size: 16px;
      border-radius: 5px;
      white-space: nowrap;
      transition: background-color 0.3s;
      border: 1px solid rgba(140, 90, 40, 0.2);
    }

    .history-entry:hover, .history-entry:active {
        background-color: #FFECB3;
    }

    /* Canvas Styling */
    canvas {
      border: 1px solid #DAA520;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      width: 100%;
      height: 30vh;
      touch-action: none; /* Crucial for mobile drawing */
      cursor: crosshair;
    }

    /* --- Mobile Responsiveness (Android Optimization) --- */
    @media (max-width: 768px) {
        .sidebar {
            /* Hide off-screen to the left using transform for better performance */
            transform: translateX(-100%);
            position: fixed;
            height: 100%;
        }
        .sidebar.open {
            /* Slide in */
            transform: translateX(0);
        }
        .menu-toggle {
            display: block; /* Show hamburger menu */
        }
        .main-area {
            padding: 70px 10px 10px 10px; /* More padding at the top to avoid the menu button, less on sides */
        }
        .inspiration-area {
            font-size: 20px;
            padding: 10px;
        }
        .tab-button {
            font-size: 24px;
        }
        .color-label {
            font-size: 16px;
        }
    }

  </style>
</head>
<body>
  <div class="overlay"></div>
  
  <!-- Hamburger Menu Button -->
  <div class="menu-toggle" id="menuToggle">â˜°</div>

  <div class="app-container">
    <div class="sidebar" id="sidebar">
      <button class="tab-button active" onclick="switchTab('Self-liking')">Self-liking</button>
      <button class="tab-button" onclick="switchTab('Expectations')">Expectations</button>
      <button class="tab-button" onclick="switchTab('Ideas')">Ideas</button>
      <button class="tab-button" onclick="switchTab('Visions')">Visions</button>
      <button class="tab-button" onclick="switchTab('Objectives')">Objectives</button>
      <button class="tab-button" onclick="switchTab('Goals')">Goals</button>
      <button class="tab-button" onclick="switchTab('Philosophies')">Philosophies</button>
      <button class="tab-button" onclick="switchTab('Experiments')">Experiments</button>
    </div>

    <div class="main-area">
        <div class="inspiration-area" id="inspirationQuote">
            Click 'Inspire Me' to spark your creativity!
        </div>

      <div class="top-buttons">
        <div>
            <button onclick="saveEntry()">ðŸ’¾ Save</button>
            <button onclick="clearEntry()">ðŸ§¼ Clear Text</button>
            <button onclick="clearCanvas()">ðŸŽ¨ Clear Canvas</button>
             <button class="inspire-button" onclick="getInspiration()">ðŸ’¡ Inspire Me</button>
        </div>
        <div>
            <label for="colorPicker" class="color-label">Draw Color:</label>
            <select id="colorPicker">
                <option value="#4E342E">Rich Brown</option>
                <option value="black">Black</option>
                <option value="red">Red</option>
                <option value="green">Green</option>
                <option value="blue">Blue</option>
                <option value="orange">Orange</option>
                <option value="purple">Purple</option>
                <option value="pink">Pink</option>
                <option value="teal">Teal</option>
                <option value="white">White</option>
            </select>
        </div>
      </div>

      <textarea id="entryInput" placeholder="What's on your mind? Let your creativity flow..."></textarea>
      <canvas id="drawCanvas"></canvas>

      <div class="history" id="historyTabs"></div>
    </div>
  </div>

  <script>
    // Initialize state and elements
    let currentTab = 'Self-liking';
    // Using a specific key for the mobile version (Android_V1)
    const STORAGE_KEY = 'creativeEntries_Android_V1';
    let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    const entryInput = document.getElementById('entryInput');
    const historyTabs = document.getElementById('historyTabs');
    const drawCanvas = document.getElementById('drawCanvas');
    const ctx = drawCanvas.getContext('2d');
    const inspirationQuote = document.getElementById('inspirationQuote');
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menuToggle');
    let drawing = false;
    let color = "#4E342E";

    const quotes = [
        "Creativity is intelligence having fun. â€“ Albert Einstein",
        "You can't use up creativity. The more you use, the more you have. â€“ Maya Angelou",
        "The chief enemy of creativity is 'good' sense. â€“ Pablo Picasso",
        "Happiness is a warm puppy. â€“ Charles M. Schulz",
        "The world would be a nicer place if everyone had the ability to love as unconditionally as a dog. â€“ M.K. Clinton",
        "Everything you can imagine is real. â€“ Pablo Picasso"
    ];

    // --- Mobile Menu Functionality ---
    menuToggle.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent click from propagating to the body
        sidebar.classList.toggle('open');
    });

    // Close the menu if the user clicks outside the sidebar (on mobile)
    document.body.addEventListener('click', () => {
        if (sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
        }
    });

    // Prevent clicks inside the sidebar from closing it
    sidebar.addEventListener('click', (e) => {
        e.stopPropagation();
    });


    function getInspiration() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        inspirationQuote.textContent = quotes[randomIndex];
    }

    function switchTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      
      const activeButton = Array.from(document.querySelectorAll('.tab-button')).find(b => b.textContent === tab);
      if (activeButton) {
        activeButton.classList.add('active');
      }
      
      entryInput.value = '';
      clearCanvas();
      loadEntries();
      // Mobile Optimization: Close the sidebar after selecting a tab
      if (sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
      }
    }

    function saveEntry() {
      const text = entryInput.value.trim();
      const drawingData = drawCanvas.toDataURL();

      if (!text && isCanvasBlank()) {
          // Use native alert/confirm (works well in WebViews)
          alert("Entry is empty. Please write or draw something.");
          return;
      }

      if (!entries[currentTab]) entries[currentTab] = [];
      
      const timestamp = new Date().toLocaleString();
      entries[currentTab].push({ text, drawing: drawingData, date: timestamp });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
      entryInput.value = '';
      clearCanvas();
      loadEntries();
    }

    function loadEntries() {
      historyTabs.innerHTML = '';
      if (!entries[currentTab]) return;
      // Display newest entries first
      entries[currentTab].slice().reverse().forEach((e, index) => {
        const actualIndex = entries[currentTab].length - 1 - index;
        const tab = document.createElement('div');
        tab.className = 'history-entry';
        tab.textContent = e.date;
        tab.onclick = () => loadSpecificEntry(e);
        
        // Right-click (or long press on mobile, which often triggers contextmenu) to delete
        tab.oncontextmenu = (ev) => {
          ev.preventDefault();
          if (confirm('Delete this entry?')) {
            entries[currentTab].splice(actualIndex, 1);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
            loadEntries();
            entryInput.value = '';
            clearCanvas();
          }
        };
        historyTabs.appendChild(tab);
      });
    }

    function loadSpecificEntry(entry) {
        entryInput.value = entry.text;
        const img = new Image();
        img.onload = function() {
            clearCanvas();
            ctx.drawImage(img, 0, 0);
        };
        if (entry.drawing) {
            img.src = entry.drawing;
        } else {
            clearCanvas();
        }
    }

    function clearEntry() {
      entryInput.value = '';
    }

    function clearCanvas() {
        ctx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
    }

    function isCanvasBlank() {
        const blank = document.createElement('canvas');
        blank.width = drawCanvas.width;
        blank.height = drawCanvas.height;
        return drawCanvas.toDataURL() === blank.toDataURL();
    }

    function resizeCanvas() {
      let data = null;
      if (drawCanvas.width > 0 && drawCanvas.height > 0 && !isCanvasBlank()) {
        data = drawCanvas.toDataURL();
      }
      
      drawCanvas.width = drawCanvas.clientWidth;
      drawCanvas.height = drawCanvas.clientHeight;
      
      if (data) {
          const img = new Image();
            img.onload = function() {
                ctx.drawImage(img, 0, 0);
            };
          img.src = data;
      }
    }

    window.addEventListener('resize', resizeCanvas);
    

    // --- Drawing functionality with Mouse and Touch support ---
    // Optimized for both inputs, essential for mobile apps.
    function getMousePos(canvas, evt) {
        const rect = canvas.getBoundingClientRect();
        return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
        };
    }

    function getTouchPos(canvas, evt) {
        const rect = canvas.getBoundingClientRect();
        // Use the first touch point
        return {
            x: evt.touches[0].clientX - rect.left,
            y: evt.touches[0].clientY - rect.top
        };
    }

    function startDrawing(pos) {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

    function draw(pos) {
        if (!drawing) return;
        ctx.strokeStyle = color;
        ctx.lineWidth = 3; // Slightly thicker line for mobile visibility
        ctx.lineCap = 'round';
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        // Optimization for smoother drawing: immediately start the next path segment
        ctx.beginPath(); 
        ctx.moveTo(pos.x, pos.y);
    }

    // Mouse events
    drawCanvas.addEventListener('mousedown', e => startDrawing(getMousePos(drawCanvas, e)));
    drawCanvas.addEventListener('mousemove', e => draw(getMousePos(drawCanvas, e)));
    drawCanvas.addEventListener('mouseup', () => drawing = false);
    drawCanvas.addEventListener('mouseleave', () => drawing = false);

    // Touch events
    // We use { passive: false } to allow preventDefault()
    drawCanvas.addEventListener('touchstart', e => {
        if (e.target === drawCanvas) {
             e.preventDefault(); // Prevent scrolling/zooming
        }
        startDrawing(getTouchPos(drawCanvas, e));
    }, { passive: false });
    drawCanvas.addEventListener('touchmove', e => {
        if (e.target === drawCanvas) {
            e.preventDefault();
       }
        draw(getTouchPos(drawCanvas, e));
    }, { passive: false });
    drawCanvas.addEventListener('touchend', () => drawing = false);


    document.getElementById('colorPicker').addEventListener('change', e => {
      color = e.target.value;
    });

     // Initialize
    document.getElementById('colorPicker').value = color;
    // Use DOMContentLoaded for faster initialization in an app context
    document.addEventListener('DOMContentLoaded', () => {
        switchTab(currentTab); 
        resizeCanvas();
        // loadEntries is called by switchTab
    });
  </script>
</body>
</html>